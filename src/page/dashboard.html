 !DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>Stock Dashboard Pro</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            padding: 30px;
            background-color: #f8f9fa;
            color: #333;
        }

        h1 {
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° */
        .summary-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .summary-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-bottom: 5px solid #3498db;
        }

        .summary-card h3 {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .summary-card p {
            margin: 10px 0 0;
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }

        /* ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .controls input,
        .controls select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            flex: 1;
        }

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background-color: #f1f4f6;
        }

        .product-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            background: #eee;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .low-stock {
            background: #ff7675;
            color: white;
        }

        .in-stock {
            background: #55efc4;
            color: #00b894;
        }
    </style>
</head>

<body>

    <h1>üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h1>

    <div id="summaryCards" class="summary-container">
        <div class="summary-card">
            <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
            <p id="totalSkus">0</p>
        </div>
        <div class="summary-card">
            <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏£‡∏ß‡∏°</h3>
            <p id="totalQty">0</p>
        </div>
        <div class="summary-card" style="border-bottom-color: #27ae60;">
            <h3>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏£‡∏ß‡∏°</h3>
            <p id="totalValue">‡∏ø0</p>
        </div>
    </div>

    <div class="controls">
        <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ SKU ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="filterTable()">
        <select id="categoryFilter" onchange="filterTable()">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
        </select>
    </div>

    <div class="table-container">
        <table id="stockTable">
            <thead>
                <tr>
                   
                    <th>SKU</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                    <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbziUDlptL6Mp1gFv0a8MoQSzgcbvh1AjJ0HN6ns6GCLWze-uiy-z64Tp-fE_uGWyPh2/exec";
        let masterData = {}; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(response => {
                // ‡∏ñ‡πâ‡∏≤ Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô { fullData: [...] } ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ response.fullData
                const rows = Array.isArray(response) ? response : response.fullData;

                let categories = new Set();
                let totalValue = 0;
                let totalQty = 0;

                rows.forEach(row => {
                    let sku = row[1];
                    let cat = row[3];
                    let desc = row[4];
                    let qty = Number(row[5]);
                    let price = Number(row[6]) || 0;
                    let imgUrl = row[7] || "";

                    if (!masterData[sku]) {
                        masterData[sku] = { desc: desc, cat: cat, total: 0, price: price, img: imgUrl };
                    }
                    masterData[sku].total += qty;
                    categories.add(cat);

                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏≠‡∏î‡∏ö‡∏ß‡∏Å)
                    if (qty > 0) totalValue += (qty * price);
                });

                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏ô Dropdown
                const catSelect = document.getElementById('categoryFilter');
                categories.forEach(c => {
                    if (c) catSelect.innerHTML += `<option value="${c}">${c}</option>`;
                });

                renderTable(masterData);

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ
                document.getElementById('totalSkus').innerText = Object.keys(masterData).length;
                totalQty = Object.values(masterData).reduce((a, b) => a + b.total, 0);
                document.getElementById('totalQty').innerText = totalQty;
                document.getElementById('totalValue').innerText = "‡∏ø" + totalValue.toLocaleString();
            });

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";

            for (let sku in data) {
                const item = data[sku];
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ (Direct Link)
                const imgTag = item.img ? item.img.replace("view?usp=drivesdk", "uc?export=view&id=").replace("/file/d/", "/uc?id=").split('/view')[0] : "";

                let row = `<tr>
                     
                    <td><strong>${sku}</strong></td>
                    <td>${item.desc}</td>
                    <td><span class="badge" style="background:#dfe6e9; color:#636e72;">${item.cat}</span></td>
                    <td>
                        <span class="badge ${item.total < 5 ? 'low-stock' : 'in-stock'}">
                            ${item.total}
                        </span>
                    </td>
                    <td>‡∏ø${item.price.toLocaleString()}</td>
                </tr>`;
                tbody.innerHTML += row;
            }
        }

        function filterTable() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const catFilter = document.getElementById('categoryFilter').value;
            const filtered = {};

            for (let sku in masterData) {
                const item = masterData[sku];
                const matchesSearch = sku.toLowerCase().includes(searchText) || item.desc.toLowerCase().includes(searchText);
                const matchesCat = catFilter === "" || item.cat === catFilter;

                if (matchesSearch && matchesCat) {
                    filtered[sku] = item;
                }
            }
            renderTable(filtered);
        }
    </script>
</body>

</html>